{{- /*
* Book Card Partial
*
* Context: Page object for a book review
*/ -}}

{{- /* Get book data from page context */ -}}
{{ $reviewTitle := .Title }}
{{ $bookTitle := .Params.book_title }}
{{ $bookAuthor := .Params.book_author }}
{{ $bookCoverParam := .Params.cover }}
{{ $rating := .Params.rating }}
{{ $publishDate := .Date.Format "January 2, 2006" }}
{{ $url := .Permalink }}

{{- /* Resolve book cover path - check if it's a page resource first */ -}}
{{ $bookCover := "" }}
{{ if $bookCoverParam }}
{{ $resource := .Resources.Get $bookCoverParam }}
{{ if $resource }}
{{ $bookCover = $resource.RelPermalink }}
{{ else }}
{{- /* If not a resource, construct path relative to page bundle */ -}}
{{ $bookCover = path.Join .RelPermalink $bookCoverParam }}
{{ end }}
{{ end }}

<article
    class="flex flex-col bg-white dark:bg-slate-800 rounded-lg overflow-hidden shadow-md transition-all duration-200 ease-in-out hover:-translate-y-0.5 hover:shadow-lg w-[250px]">
    <a href="{{ $url }}" class="flex flex-col h-full !no-underline text-inherit">
        <div class="relative overflow-hidden aspect-[2/3]">
            {{ if $bookCover }}
            <img src="{{ $bookCover }}" alt="{{ .Params.book_cover_alt | default (printf " %s by %s" $bookTitle
                $bookAuthor) }}" loading="lazy" class="w-full h-full object-contain block">
            {{ else }}
            <div class="w-full h-full bg-gray-100 dark:bg-gray-700 flex items-center justify-center text-gray-500 dark:text-gray-400 text-sm">
                <span>No Cover</span>
            </div>
            {{ end }}

            {{ with $rating }}
            <div class="absolute top-2 right-2 bg-black dark:bg-slate-900 bg-opacity-75 dark:bg-opacity-90 text-white px-2 py-1 rounded text-xs font-medium">
                {{ . }}
            </div>
            {{ end }}
        </div>

        <div class="p-4 flex-shrink-0">
            <h3 class="mb-1 text-lg font-semibold leading-tight text-gray-800 dark:text-gray-100 line-clamp-2">
                {{ $bookTitle }}
            </h3>
            <p class="mb-2 text-sm text-gray-600 dark:text-gray-400 font-medium">
                by
                {{ $bookAuthor }}
            </p>
            {{ if and $reviewTitle (ne $reviewTitle $bookTitle) }}
            <p class="mb-2 text-sm text-gray-700 dark:text-gray-300 italic line-clamp-1">
                "{{ $reviewTitle }}"
            </p>
            {{ end }}
            <time class="text-gray-600 dark:text-gray-400 text-sm font-normal" datetime="{{ .Date.Format " 2006-01-02" }}">
                {{ $publishDate }}
            </time>
        </div>
    </a>
</article>